<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Giftly - –°–∞–Ω—Ç–∞</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Web Block Overlay -->
    <div id="webBlock" style="display: none; position: fixed; inset: 0; z-index: 9999; background: linear-gradient(180deg, #e8f5e9 0%, #c8e6c9 50%, #a5d6a7 100%); align-items: center; justify-content: center; flex-direction: column; padding: 40px; text-align: center;">
        <div style="font-size: 80px; margin-bottom: 20px;">üéÖ</div>
        <h1 style="color: #1b5e20; font-size: 28px; margin-bottom: 16px;">–¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞</h1>
        <p style="color: #388e3c; font-size: 16px; margin-bottom: 32px; max-width: 300px;">
            –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Telegram. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!
        </p>
        <a href="https://t.me/giftl_robot" style="background: #34c759; color: white; padding: 16px 32px; border-radius: 12px; text-decoration: none; font-weight: 600; font-size: 16px;">
            üì± –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram
        </a>
    </div>

    <!-- Ambient Background -->
    <div class="ambient-bg">
        <div class="ambient-orb"></div>
        <div class="ambient-orb"></div>
        <div class="ambient-orb"></div>
        <div class="ambient-orb"></div>
    </div>

    <div class="app" id="mainApp">
        <nav class="bottom-nav" id="bottomNav">
            <a href="index.html" class="nav-item">
                <span class="nav-icon">üéÅ</span>
                <span class="nav-label">–ñ–µ–ª–∞–Ω–∏—è</span>
            </a>
            <a href="santa.html" class="nav-item active">
                <span class="nav-icon">üéÖ</span>
                <span class="nav-label">–°–∞–Ω—Ç–∞</span>
            </a>
            <a href="profile.html" class="nav-item">
                <span class="nav-icon">üë§</span>
                <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
            </a>
        </nav>

        <!-- Main View -->
        <div id="mainView">
            <header class="hero-header">
                <div class="garland">
                    <div class="garland-wire"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                    <div class="garland-light"></div>
                </div>
                <div class="hero-icon" style="margin-top: 20px;">üéÖ</div>
                <h1 class="hero-title">–¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞</h1>
                <p class="hero-subtitle">–û–±–º–µ–Ω–∏–≤–∞–π—Ç–µ—Å—å –ø–æ–¥–∞—Ä–∫–∞–º–∏ —Å –¥—Ä—É–∑—å—è–º–∏</p>
            </header>

            <div class="section">
                <button class="btn btn-large btn-primary" id="createGroupBtn">
                    üéÑ –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
                </button>
            </div>

            <div class="section">
                <div class="section-label">–ú–æ–∏ –≥—Ä—É–ø–ø—ã</div>
                <div id="groupsList"></div>
                <div class="empty-state" id="emptyGroups">
                    <div class="empty-icon">üéÑ</div>
                    <h3>–ù–µ—Ç –≥—Ä—É–ø–ø</h3>
                    <p>–°–æ–∑–¥–∞–π –≥—Ä—É–ø–ø—É –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Å—å</p>
                </div>
            </div>
        </div>

        <!-- Detail View -->
        <div id="detailView" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <button class="back-btn" id="backBtn">‚Üê –ù–∞–∑–∞–¥</button>
                    <div></div>
                </div>
            </header>

            <header class="hero-header" style="margin-top: -1px;">
                <h1 class="hero-title" id="groupName">–ì—Ä—É–ø–ø–∞</h1>
                <p class="hero-subtitle" id="groupStatus">–°—Ç–∞—Ç—É—Å</p>
            </header>

            <div id="resultSection" style="display: none;">
                <div class="result-card">
                    <div class="result-label">üéÅ –¢—ã –¥–∞—Ä–∏—à—å –ø–æ–¥–∞—Ä–æ–∫:</div>
                    <div class="result-name" id="targetName">–ò–º—è</div>
                    <button class="btn btn-secondary" id="viewWishesBtn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∂–µ–ª–∞–Ω–∏—è</button>
                </div>
            </div>

            <div class="section">
                <div class="section-label">–£—á–∞—Å—Ç–Ω–∏–∫–∏ (<span id="participantsCount">0</span>)</div>
                <div id="participantsList"></div>
            </div>

            <div class="section">
                <div class="section-label">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</div>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="inviteLink" class="form-input" readonly style="flex: 1;">
                    <button class="btn btn-primary" id="copyInviteBtn">üìã</button>
                </div>
                <button class="btn btn-large btn-primary" id="shareInviteBtn" style="margin-top: 12px;">
                    üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
                </button>
            </div>

            <div class="section" id="adminSection" style="display: none;">
                <div class="section-label">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                <button class="btn btn-large btn-success" id="shuffleBtn">
                    üé≤ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∂–µ—Ä–µ–±—å—ë–≤–∫—É
                </button>
                <p style="text-align: center; color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                    –ú–∏–Ω–∏–º—É–º 3 —É—á–∞—Å—Ç–Ω–∏–∫–∞
                </p>
            </div>
        </div>

        <!-- Create Modal -->
        <div class="modal" id="createModal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2>–ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞</h2>
                    <button class="modal-close" id="closeCreateModal">√ó</button>
                </div>
                <form id="createForm" class="modal-body">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="groupNameInput" class="form-input" placeholder="–ù–æ–≤—ã–π –≥–æ–¥ 2025" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–ë—é–¥–∂–µ—Ç</label>
                            <input type="number" id="groupBudget" class="form-input" placeholder="2000">
                        </div>
                        <div class="form-group" style="max-width: 100px;">
                            <label class="form-label">–í–∞–ª—é—Ç–∞</label>
                            <select id="groupCurrency" class="form-input">
                                <option value="‚ÇΩ">‚ÇΩ</option>
                                <option value="$">$</option>
                                <option value="‚Ç¨">‚Ç¨</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelCreateBtn">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Wishes Modal -->
        <div class="modal" id="wishesModal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2>–ú–æ–∏ –∂–µ–ª–∞–Ω–∏—è</h2>
                    <button class="modal-close" id="closeWishesModal">√ó</button>
                </div>
                <form id="wishesForm" class="modal-body">
                    <p style="color: var(--text-secondary); font-size: 15px; margin-bottom: 16px;">
                        –≠—Ç–æ —É–≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–≤–æ–π –¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞
                    </p>
                    <div id="wishesInputs"></div>
                    <button type="button" class="btn btn-secondary btn-large" id="addWishBtn" style="margin-bottom: 16px;">
                        + –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                    <button type="submit" class="btn btn-primary btn-large">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <div class="toast" id="toast"></div>
    </div>

    <script src="config.js"></script>
    <script>
        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–µ–±-–≤–µ—Ä—Å–∏–∏
        const tgCheck = window.Telegram?.WebApp;
        if (!tgCheck || !tgCheck.initDataUnsafe?.user) {
            document.getElementById('webBlock').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('bottomNav').style.display = 'none';
        } else {
            document.getElementById('webBlock').style.display = 'none';
        }
    </script>
    <script src="santa.js"></script>
</body>
</html>
